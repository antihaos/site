<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Космический Университет</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'ios-bg': 'rgba(242, 242, 247, 0.8)',
                        'ios-card': 'rgba(255, 255, 255, 0.8)',
                        'ios-border': 'rgba(60, 60, 67, 0.18)',
                        'ios-dark-bg': 'rgba(28, 28, 30, 0.8)',
                        'ios-dark-card': 'rgba(44, 44, 46, 0.8)',
                        'ios-dark-border': 'rgba(84, 84, 88, 0.65)',
                    },
                    backdropBlur: {
                        'ios': '20px',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .bg-cosmic {
                background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            }
            .bg-cosmic-light {
                background: radial-gradient(ellipse at bottom, #4F6C9B 0%, #1B2735 100%);
            }
            .glass-effect {
                @apply bg-ios-card dark:bg-ios-dark-card backdrop-blur-ios border border-ios-border dark:border-ios-dark-border;
            }
            .star {
                position: absolute;
                background-color: white;
                border-radius: 50%;
                animation: twinkle 5s infinite;
            }
            @keyframes twinkle {
                0%, 100% { opacity: 0.2; }
                50% { opacity: 1; }
            }
            .page {
                transition: opacity 0.3s ease;
            }
            .course-card, .lecture-card, .task-card, .lesson-card, .subject-card {
                transition: all 0.3s ease;
            }
            .widget-btn {
                transition: all 0.2s ease;
            }
        }
    </style>
</head>
<body class="bg-cosmic-light dark:bg-cosmic min-h-screen text-gray-900 dark:text-white overflow-x-hidden transition-colors duration-300">
    <!-- Космический фон со звездами -->
    <div id="space-bg" class="fixed inset-0 z-0"></div>
    
    <!-- Верхняя панель -->
    <header class="fixed top-0 left-0 right-0 glass-effect border-b border-ios-border dark:border-ios-dark-border mx-auto z-30">
        <div class="max-w-md mx-auto flex justify-between items-center p-4">
            <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent" id="page-title">Космический Университет</h1>
            <div class="flex items-center space-x-3">
                <button id="notifications-btn" class="relative p-2 rounded-full bg-gray-200 dark:bg-gray-700">
                    <i class="fas fa-bell text-gray-700 dark:text-gray-300"></i>
                    <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center" id="notification-count">3</span>
                </button>
                <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700">
                    <i class="fas fa-moon text-gray-700"></i>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Основной контейнер -->
    <div class="relative z-10 max-w-md mx-auto min-h-screen flex flex-col pt-16 pb-20">
        <!-- Контейнер страниц -->
        <main class="flex-1 overflow-y-auto px-4" id="main-content">
            <!-- Страницы будут рендериться здесь через JavaScript -->
        </main>
    </div>
    
    <!-- Нижняя панель навигации -->
    <nav class="fixed bottom-0 left-0 right-0 glass-effect border-t border-ios-border dark:border-ios-dark-border mx-auto z-20">
        <div class="max-w-md mx-auto flex justify-around items-center py-3" id="bottom-nav">
            <!-- Навигация будет рендериться здесь через JavaScript -->
        </div>
    </nav>

    <!-- Модальное окно для управления Gist -->
    <div id="gist-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-effect rounded-3xl p-6 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Управление данными</h3>
                <button id="close-gist-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">GitHub Personal Access Token</label>
                    <input type="password" id="github-token" placeholder="Введите ваш токен" 
                           class="w-full glass-effect rounded-xl p-3 border border-ios-border dark:border-ios-dark-border">
                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
                        Токен нужен для доступа к GitHub Gist API
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Gist ID (для загрузки)</label>
                    <input type="text" id="gist-id" placeholder="Оставьте пустым для создания нового" 
                           class="w-full glass-effect rounded-xl p-3 border border-ios-border dark:border-ios-dark-border">
                </div>
                <div class="flex space-x-2">
                    <button id="load-gist" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl transition-colors">
                        <i class="fas fa-download mr-2"></i>Загрузить
                    </button>
                    <button id="save-gist" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl transition-colors">
                        <i class="fas fa-save mr-2"></i>Сохранить
                    </button>
                </div>
                <div id="gist-status" class="text-sm text-center hidden"></div>
            </div>
        </div>
    </div>

    <script>
        // ========== КОНФИГУРАЦИЯ GIST ==========
        const GIST_CONFIG = {
            // Замените на ваш GitHub Personal Access Token
            // Можно получить здесь: https://github.com/settings/tokens
            GITHUB_TOKEN: localStorage.getItem('github_token') || '',
            
            // ID существующего Gist (если есть)
            GIST_ID: localStorage.getItem('gist_id') || '',
            
            // Имя файла в Gist
            FILENAME: 'university-data.json',
            
            // Описание Gist
            DESCRIPTION: 'Данные приложения Космический Университет'
        };

        // ========== ДАННЫЕ ПРИЛОЖЕНИЯ В JSON ФОРМАТЕ ==========
        
        // Данные для навигации
        const navigationData = {
            "tabs": [
                {
                    "id": "home-page",
                    "icon": "fas fa-home",
                    "label": "Главная",
                    "default": true
                },
                {
                    "id": "study-page", 
                    "icon": "fas fa-book",
                    "label": "Учеба"
                },
                {
                    "id": "lectures-page",
                    "icon": "fas fa-video", 
                    "label": "Лекции"
                },
                {
                    "id": "tasks-page",
                    "icon": "fas fa-tasks",
                    "label": "Задания"
                },
                {
                    "id": "schedule-page",
                    "icon": "fas fa-calendar",
                    "label": "Расписание"
                },
                {
                    "id": "progress-page",
                    "icon": "fas fa-chart-line",
                    "label": "Успеваемость"
                },
                {
                    "id": "settings-page",
                    "icon": "fas fa-cog",
                    "label": "Настройки"
                }
            ]
        };

        // Основные данные приложения
        let appData = {
            widgets: {
                "home": {
                    "title": "Добро пожаловать!",
                    "subtitle": "Начните своё космическое путешествие в мир знаний. Выберите раздел ниже для продолжения.",
                    "widgets": [
                        {
                            "id": "lectures",
                            "icon": "fas fa-book",
                            "color": "blue",
                            "title": "Лекции", 
                            "subtitle": "12 новых",
                            "action": "lectures-page"
                        },
                        {
                            "id": "tasks",
                            "icon": "fas fa-tasks", 
                            "color": "green",
                            "title": "Задания",
                            "subtitle": "3 на проверке", 
                            "action": "tasks-page"
                        },
                        {
                            "id": "schedule",
                            "icon": "fas fa-calendar",
                            "color": "purple", 
                            "title": "Расписание",
                            "subtitle": "2 пары сегодня",
                            "action": "schedule-page"
                        },
                        {
                            "id": "progress", 
                            "icon": "fas fa-chart-line",
                            "color": "yellow",
                            "title": "Успеваемость",
                            "subtitle": "85% прогресс",
                            "action": "progress-page"
                        }
                    ],
                    "notifications": [
                        {
                            "id": 1,
                            "icon": "fas fa-book",
                            "color": "blue",
                            "title": "Новая лекция по астрофизике",
                            "subtitle": "Добавлена 2 часа назад"
                        },
                        {
                            "id": 2,
                            "icon": "fas fa-clock",
                            "color": "red", 
                            "title": "Срок сдачи задания истекает",
                            "subtitle": "Осталось 2 дня"
                        }
                    ],
                    "news": [
                        {
                            "id": 1,
                            "color": "green",
                            "title": "Запуск новой лаборатории",
                            "content": "Открыта лаборатория космических исследований с современным оборудованием."
                        },
                        {
                            "id": 2,
                            "color": "blue", 
                            "title": "Конференция по астрономии",
                            "content": "Приглашаем всех желающих на ежегодную конференцию 15 ноября."
                        },
                        {
                            "id": 3,
                            "color": "purple",
                            "title": "Новые курсы", 
                            "content": "Доступны для записи курсы по космической биологии и инженерии."
                        }
                    ]
                }
            },
            study: {
                "title": "Моё обучение",
                "subtitle": "Ваши текущие курсы и материалы для изучения.",
                "courses": [
                    {
                        "id": "astrophysics",
                        "title": "Астрофизика",
                        "instructor": "Проф. Иванов",
                        "status": "active",
                        "progress": 75,
                        "progressColor": "green"
                    },
                    {
                        "id": "engineering", 
                        "title": "Космическая инженерия",
                        "instructor": "Проф. Петрова", 
                        "status": "new",
                        "progress": 30,
                        "progressColor": "blue"
                    },
                    {
                        "id": "planetology",
                        "title": "Планетология",
                        "instructor": "Проф. Сидоров",
                        "status": "upcoming", 
                        "progress": 0,
                        "progressColor": "yellow"
                    }
                ]
            },
            lectures: {
                "title": "Лекции",
                "subtitle": "Все доступные лекции по вашим курсам.",
                "filters": [
                    {"id": "all", "label": "Все лекции"},
                    {"id": "new", "label": "Новые"},
                    {"id": "in-progress", "label": "В процессе"},
                    {"id": "completed", "label": "Завершённые"}
                ],
                "lectures": [
                    {
                        "id": 1,
                        "status": "new",
                        "title": "Введение в астрофизику",
                        "description": "Основные понятия и методы астрофизики",
                        "duration": "45 мин",
                        "instructor": "Проф. Иванов",
                        "added": "2 дня назад",
                        "progress": 0
                    },
                    {
                        "id": 2,
                        "status": "in-progress", 
                        "title": "Солнечная система",
                        "description": "Планеты, спутники и малые тела",
                        "duration": "52 мин", 
                        "instructor": "Проф. Петрова",
                        "added": "5 дней назад",
                        "progress": 65
                    },
                    {
                        "id": 3,
                        "status": "completed",
                        "title": "Звёзды и галактики", 
                        "description": "Эволюция звёзд и структура галактик",
                        "duration": "38 мин",
                        "instructor": "Проф. Иванов", 
                        "added": "2 недели назад",
                        "progress": 100
                    }
                ],
                "recommended": [
                    {
                        "id": 1,
                        "title": "Чёрные дыры",
                        "duration": "32 мин",
                        "instructor": "Проф. Сидоров",
                        "color": "blue"
                    },
                    {
                        "id": 2,
                        "title": "Космология", 
                        "duration": "41 мин",
                        "instructor": "Проф. Иванов",
                        "color": "purple"
                    }
                ]
            },
            tasks: {
                "title": "Задания",
                "subtitle": "Все задания по вашим курсам с сроками сдачи.",
                "stats": [
                    {"count": 3, "label": "Активных", "color": "blue"},
                    {"count": 7, "label": "Завершено", "color": "green"}, 
                    {"count": 1, "label": "Просрочено", "color": "red"}
                ],
                "urgent": [
                    {
                        "id": 1,
                        "icon": "fas fa-flag",
                        "color": "red",
                        "title": "Расчёт орбиты спутника", 
                        "deadline": "завтра, 10:00"
                    }
                ],
                "active": [
                    {
                        "id": 2,
                        "icon": "fas fa-file-alt",
                        "color": "blue",
                        "title": "Лабораторная работа №3",
                        "deadline": "25 ноября"
                    },
                    {
                        "id": 3,
                        "icon": "fas fa-chart-bar",
                        "color": "yellow", 
                        "title": "Анализ данных телескопа",
                        "deadline": "30 ноября"
                    }
                ],
                "completed": [
                    {
                        "id": 4,
                        "icon": "fas fa-check",
                        "color": "green",
                        "title": "Контрольная работа №1",
                        "details": "Оценка: 95% · Сдано 15 ноября"
                    },
                    {
                        "id": 5,
                        "icon": "fas fa-check",
                        "color": "green",
                        "title": "Проект 'Солнечная система'", 
                        "details": "Оценка: 88% · Сдано 10 ноября"
                    }
                ]
            },
            schedule: {
                "title": "Расписание",
                "subtitle": "Ваше расписание занятий на неделю.",
                "currentWeek": "20-24 ноября",
                "days": [
                    {
                        "id": "mon",
                        "label": "ПН",
                        "date": "20",
                        "active": true,
                        "lessons": [
                            {
                                "time": "09:00-10:30",
                                "subject": "Астрофизика",
                                "type": "Лекция",
                                "room": "301",
                                "instructor": "Проф. Иванов",
                                "color": "blue"
                            },
                            {
                                "time": "11:00-12:30",
                                "subject": "Космическая инженерия",
                                "type": "Практика",
                                "room": "415",
                                "instructor": "Проф. Петрова",
                                "color": "green"
                            }
                        ]
                    },
                    {
                        "id": "tue",
                        "label": "ВТ",
                        "date": "21",
                        "active": false,
                        "lessons": [
                            {
                                "time": "10:00-11:30",
                                "subject": "Планетология",
                                "type": "Лекция",
                                "room": "302",
                                "instructor": "Проф. Сидоров",
                                "color": "purple"
                            }
                        ]
                    },
                    {
                        "id": "wed",
                        "label": "СР",
                        "date": "22",
                        "active": false,
                        "lessons": []
                    },
                    {
                        "id": "thu",
                        "label": "ЧТ",
                        "date": "23",
                        "active": false,
                        "lessons": [
                            {
                                "time": "14:00-15:30",
                                "subject": "Астрофизика",
                                "type": "Лабораторная",
                                "room": "105",
                                "instructor": "Проф. Иванов",
                                "color": "blue"
                            }
                        ]
                    },
                    {
                        "id": "fri",
                        "label": "ПТ",
                        "date": "24",
                        "active": false,
                        "lessons": [
                            {
                                "time": "09:00-10:30",
                                "subject": "Космическая инженерия",
                                "type": "Лекция",
                                "room": "301",
                                "instructor": "Проф. Петрова",
                                "color": "green"
                            }
                        ]
                    }
                ]
            },
            progress: {
                "title": "Успеваемость",
                "subtitle": "Ваша успеваемость по всем предметам.",
                "overallProgress": 85,
                "subjects": [
                    {
                        "name": "Астрофизика",
                        "instructor": "Проф. Иванов",
                        "progress": 92,
                        "color": "green"
                    },
                    {
                        "name": "Космическая инженерия",
                        "instructor": "Проф. Петрова",
                        "progress": 78,
                        "color": "blue"
                    },
                    {
                        "name": "Планетология",
                        "instructor": "Проф. Сидоров",
                        "progress": 65,
                        "color": "purple"
                    }
                ]
            },
            settings: {
                "title": "Настройки",
                "subtitle": "Настройте приложение под свои предпочтения.",
                "sections": [
                    {
                        "title": "Основные настройки",
                        "items": [
                            {
                                "id": "notifications",
                                "title": "Уведомления",
                                "subtitle": "Push-уведомления о новых материалах",
                                "type": "toggle",
                                "value": true
                            },
                            {
                                "id": "email-notifications",
                                "title": "Email-уведомления",
                                "subtitle": "Уведомления на электронную почту",
                                "type": "toggle",
                                "value": false
                            }
                        ]
                    },
                    {
                        "title": "Конфиденциальность",
                        "items": [
                            {
                                "id": "analytics",
                                "title": "Сбор аналитики",
                                "subtitle": "Помогите улучшить приложение",
                                "type": "toggle",
                                "value": true
                            }
                        ]
                    }
                ]
            },
            // Мета-данные
            meta: {
                version: "1.0.0",
                lastUpdated: new Date().toISOString(),
                created: new Date().toISOString()
            }
        };

        // ========== GIST API ФУНКЦИИ ==========

        // Функция для загрузки данных из Gist
        async function loadFromGist() {
            const token = document.getElementById('github-token').value || GIST_CONFIG.GITHUB_TOKEN;
            const gistId = document.getElementById('gist-id').value || GIST_CONFIG.GIST_ID;

            if (!token) {
                showGistStatus('Ошибка: Не указан GitHub токен', 'error');
                return;
            }

            if (!gistId) {
                showGistStatus('Ошибка: Не указан Gist ID', 'error');
                return;
            }

            showGistStatus('Загрузка данных...', 'loading');

            try {
                const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Ошибка HTTP: ${response.status}`);
                }

                const gist = await response.json();
                const file = gist.files[GIST_CONFIG.FILENAME];

                if (!file) {
                    throw new Error('Файл с данными не найден в Gist');
                }

                const loadedData = JSON.parse(file.content);
                
                // Обновляем данные приложения
                Object.assign(appData, loadedData);
                
                // Сохраняем настройки
                localStorage.setItem('github_token', token);
                localStorage.setItem('gist_id', gistId);
                GIST_CONFIG.GITHUB_TOKEN = token;
                GIST_CONFIG.GIST_ID = gistId;

                // Перерисовываем приложение
                renderAllPages();
                showGistStatus('Данные успешно загружены!', 'success');
                
                // Закрываем модальное окно через 2 секунды
                setTimeout(() => {
                    hideGistModal();
                    showNotification('Данные загружены из GitHub Gist');
                }, 2000);

            } catch (error) {
                console.error('Ошибка загрузки:', error);
                showGistStatus(`Ошибка загрузки: ${error.message}`, 'error');
            }
        }

        // Функция для сохранения данных в Gist
        async function saveToGist() {
            const token = document.getElementById('github-token').value || GIST_CONFIG.GITHUB_TOKEN;
            const gistId = document.getElementById('gist-id').value || GIST_CONFIG.GIST_ID;

            if (!token) {
                showGistStatus('Ошибка: Не указан GitHub токен', 'error');
                return;
            }

            showGistStatus('Сохранение данных...', 'loading');

            try {
                // Обновляем мета-данные
                appData.meta.lastUpdated = new Date().toISOString();

                const gistData = {
                    description: GIST_CONFIG.DESCRIPTION,
                    public: false,
                    files: {
                        [GIST_CONFIG.FILENAME]: {
                            content: JSON.stringify(appData, null, 2)
                        }
                    }
                };

                let response;
                if (gistId) {
                    // Обновляем существующий Gist
                    response = await fetch(`https://api.github.com/gists/${gistId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });
                } else {
                    // Создаем новый Gist
                    response = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(gistData)
                    });
                }

                if (!response.ok) {
                    throw new Error(`Ошибка HTTP: ${response.status}`);
                }

                const result = await response.json();
                
                // Сохраняем настройки
                const newGistId = result.id;
                localStorage.setItem('github_token', token);
                localStorage.setItem('gist_id', newGistId);
                GIST_CONFIG.GITHUB_TOKEN = token;
                GIST_CONFIG.GIST_ID = newGistId;

                // Обновляем поле Gist ID
                document.getElementById('gist-id').value = newGistId;

                showGistStatus('Данные успешно сохранены!', 'success');
                
                // Закрываем модальное окно через 2 секунды
                setTimeout(() => {
                    hideGistModal();
                    showNotification('Данные сохранены в GitHub Gist');
                }, 2000);

            } catch (error) {
                console.error('Ошибка сохранения:', error);
                showGistStatus(`Ошибка сохранения: ${error.message}`, 'error');
            }
        }

        // Функция для показа статуса операций с Gist
        function showGistStatus(message, type) {
            const statusElement = document.getElementById('gist-status');
            statusElement.textContent = message;
            statusElement.className = 'text-sm text-center';
            
            switch (type) {
                case 'success':
                    statusElement.classList.add('text-green-500');
                    break;
                case 'error':
                    statusElement.classList.add('text-red-500');
                    break;
                case 'loading':
                    statusElement.classList.add('text-blue-500');
                    break;
            }
            
            statusElement.classList.remove('hidden');
        }

        // Функции для управления модальным окном
        function showGistModal() {
            document.getElementById('gist-modal').classList.remove('hidden');
            // Заполняем поля из сохраненных настроек
            document.getElementById('github-token').value = GIST_CONFIG.GITHUB_TOKEN;
            document.getElementById('gist-id').value = GIST_CONFIG.GIST_ID;
        }

        function hideGistModal() {
            document.getElementById('gist-modal').classList.add('hidden');
            document.getElementById('gist-status').classList.add('hidden');
        }

        // ========== ФУНКЦИИ РЕНДЕРИНГА ==========

        // Функция для создания звездного фона
        function createStars() {
            const spaceBg = document.getElementById('space-bg');
            const starCount = 150;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                const size = Math.random() * 2 + 1;
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                const delay = Math.random() * 5;
                
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${left}%`;
                star.style.top = `${top}%`;
                star.style.animationDelay = `${delay}s`;
                
                spaceBg.appendChild(star);
            }
        }

        // Функция рендеринга навигации
        function renderNavigation() {
            const navContainer = document.getElementById('bottom-nav');
            navContainer.innerHTML = '';
            
            navigationData.tabs.forEach(tab => {
                const isActive = tab.default || false;
                const button = document.createElement('button');
                button.className = `tab-btn flex flex-col items-center ${isActive ? 'text-blue-500' : 'text-gray-500'}`;
                button.setAttribute('data-page', tab.id);
                
                button.innerHTML = `
                    <i class="${tab.icon} text-lg"></i>
                    <span class="text-xs mt-1">${tab.label}</span>
                `;
                
                navContainer.appendChild(button);
            });
        }

        // Функция рендеринга главной страницы
        function renderHomePage() {
            const data = appData.widgets.home;
            
            return `
                <div id="home-page" class="page">
                    <div class="glass-effect rounded-3xl p-6 mb-4 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-rocket mr-2 text-blue-400"></i>
                            ${data.title}
                        </h2>
                        <p class="text-gray-600 dark:text-gray-300">${data.subtitle}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        ${data.widgets.map(widget => `
                            <button class="widget-btn glass-effect rounded-2xl p-4 text-center transition-transform hover:scale-105 active:scale-95" data-action="${widget.action}">
                                <i class="${widget.icon} text-2xl text-${widget.color}-500 mb-2"></i>
                                <h3 class="font-medium">${widget.title}</h3>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">${widget.subtitle}</p>
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="glass-effect rounded-3xl p-6 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-bell mr-2 text-yellow-500"></i>
                            Уведомления
                        </h2>
                        <div class="space-y-3">
                            ${data.notifications.map(notification => `
                                <div class="flex items-start notification-item" data-id="${notification.id}">
                                    <div class="bg-${notification.color}-100 dark:bg-${notification.color}-900 p-2 rounded-full mr-3">
                                        <i class="${notification.icon} text-${notification.color}-500 dark:text-${notification.color}-300"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-medium">${notification.title}</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">${notification.subtitle}</p>
                                    </div>
                                    <button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 ml-2">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="glass-effect rounded-3xl p-6 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-newspaper mr-2 text-green-500"></i>
                            Новости университета
                        </h2>
                        <div class="space-y-4">
                            ${data.news.map(item => `
                                <div class="border-l-4 border-${item.color}-500 pl-4 py-1">
                                    <p class="font-medium">${item.title}</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">${item.content}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Кнопка управления Gist -->
                    <div class="glass-effect rounded-3xl p-6 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-cloud mr-2 text-blue-500"></i>
                            Облачное хранилище
                        </h2>
                        <p class="text-gray-600 dark:text-gray-300 mb-4">
                            Сохраняйте и загружайте ваши данные через GitHub Gist
                        </p>
                        <button id="manage-gist" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white py-3 rounded-xl transition-all transform hover:scale-105">
                            <i class="fas fa-cog mr-2"></i>Управление данными
                        </button>
                        ${GIST_CONFIG.GIST_ID ? `
                            <div class="mt-3 text-center">
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    Текущий Gist: ${GIST_CONFIG.GIST_ID}
                                </p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Функция рендеринга страницы учебы
        function renderStudyPage() {
            const data = appData.study;
            
            return `
                <div id="study-page" class="page hidden">
                    <div class="glass-effect rounded-3xl p-6 mb-4 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-graduation-cap mr-2 text-purple-500"></i>
                            ${data.title}
                        </h2>
                        <p class="text-gray-600 dark:text-gray-300">${data.subtitle}</p>
                    </div>
                    
                    <div class="space-y-4">
                        ${data.courses.map(course => `
                            <div class="course-card glass-effect rounded-2xl p-5 transition-transform hover:scale-[1.02] active:scale-100" data-course="${course.id}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-semibold">${course.title}</h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${course.instructor}</p>
                                    </div>
                                    <span class="bg-${course.progressColor}-100 dark:bg-${course.progressColor}-900 text-${course.progressColor}-800 dark:text-${course.progressColor}-200 text-xs px-2 py-1 rounded-full">
                                        ${course.status === 'active' ? 'Активно' : course.status === 'new' ? 'Новый' : 'Скоро начало'}
                                    </span>
                                </div>
                                <div class="mt-4 flex items-center">
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                        <div class="bg-${course.progressColor}-500 h-2 rounded-full" style="width: ${course.progress}%"></div>
                                    </div>
                                    <span class="ml-2 text-sm text-gray-600 dark:text-gray-400">${course.progress}%</span>
                                </div>
                                <div class="mt-4 flex space-x-2">
                                    <button class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-lg text-sm transition-colors">
                                        <i class="fas fa-play mr-1"></i> ${course.progress > 0 ? 'Продолжить' : 'Начать'}
                                    </button>
                                    <button class="flex-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm transition-colors">
                                        <i class="fas fa-info-circle mr-1"></i> Подробнее
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Функция рендеринга страницы лекций
        function renderLecturesPage() {
            const data = appData.lectures;
            
            return `
                <div id="lectures-page" class="page hidden">
                    <div class="glass-effect rounded-3xl p-6 mb-4 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-video mr-2 text-blue-500"></i>
                            ${data.title}
                        </h2>
                        <p class="text-gray-600 dark:text-gray-300">${data.subtitle}</p>
                    </div>

                    <div class="glass-effect rounded-3xl p-4 mb-4">
                        <div class="flex overflow-x-auto space-x-2 pb-2">
                            ${data.filters.map((filter, index) => `
                                <button class="filter-btn px-4 py-2 rounded-full ${index === 0 ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'} text-sm whitespace-nowrap" data-filter="${filter.id}">
                                    ${filter.label}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="space-y-4">
                        ${data.lectures.map(lecture => `
                            <div class="lecture-card glass-effect rounded-2xl p-5 transition-transform hover:scale-[1.02] active:scale-100" data-lecture="${lecture.id}" data-status="${lecture.status}">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <span class="bg-${lecture.status === 'new' ? 'green' : lecture.status === 'in-progress' ? 'blue' : 'green'}-100 dark:bg-${lecture.status === 'new' ? 'green' : lecture.status === 'in-progress' ? 'blue' : 'green'}-900 text-${lecture.status === 'new' ? 'green' : lecture.status === 'in-progress' ? 'blue' : 'green'}-800 dark:text-${lecture.status === 'new' ? 'green' : lecture.status === 'in-progress' ? 'blue' : 'green'}-200 text-xs px-2 py-1 rounded-full">
                                            ${lecture.status === 'new' ? 'Новая' : lecture.status === 'in-progress' ? 'В процессе' : 'Завершено'}
                                        </span>
                                        <h3 class="font-semibold mt-2">${lecture.title}</h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">${lecture.description}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm text-gray-600 dark:text-gray-400">${lecture.duration}</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">${lecture.instructor}</p>
                                    </div>
                                </div>
                                ${lecture.progress > 0 ? `
                                    <div class="mb-3">
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                            <div class="bg-${lecture.status === 'completed' ? 'green' : 'blue'}-500 h-2 rounded-full" style="width: ${lecture.progress}%"></div>
                                        </div>
                                        <div class="flex justify-between text-xs text-gray-600 dark:text-gray-400 mt-1">
                                            <span>Просмотрено: ${lecture.progress}%</span>
                                            <span>${Math.round(lecture.progress/100 * parseInt(lecture.duration))} мин / ${lecture.duration}</span>
                                        </div>
                                    </div>
                                ` : ''}
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-2">
                                        <button class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-sm transition-colors flex items-center">
                                            <i class="fas fa-${lecture.status === 'completed' ? 'redo' : 'play'} mr-2"></i> ${lecture.status === 'completed' ? 'Пересмотреть' : lecture.status === 'in-progress' ? 'Продолжить' : 'Смотреть'}
                                        </button>
                                        <button class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm transition-colors">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-xs text-gray-500 dark:text-gray-400">${lecture.added}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="glass-effect rounded-3xl p-6 mt-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-star mr-2 text-yellow-500"></i>
                            Рекомендуемые лекции
                        </h2>
                        <div class="space-y-3">
                            ${data.recommended.map(lecture => `
                                <div class="flex items-center justify-between p-3 rounded-xl bg-${lecture.color}-50 dark:bg-${lecture.color}-900/20">
                                    <div class="flex items-center">
                                        <div class="bg-${lecture.color}-100 dark:bg-${lecture.color}-800 p-2 rounded-lg mr-3">
                                            <i class="fas fa-play text-${lecture.color}-500 dark:text-${lecture.color}-300"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">${lecture.title}</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">${lecture.duration} · ${lecture.instructor}</p>
                                        </div>
                                    </div>
                                    <button class="text-${lecture.color}-500 hover:text-${lecture.color}-600 text-sm">
                                        Смотреть
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Функция рендеринга страницы заданий
        function renderTasksPage() {
            const data = appData.tasks;
            
            return `
                <div id="tasks-page" class="page hidden">
                    <div class="glass-effect rounded-3xl p-6 mb-4 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-tasks mr-2 text-green-500"></i>
                            ${data.title}
                        </h2>
                        <p class="text-gray-600 dark:text-gray-300">${data.subtitle}</p>
                    </div>

                    <div class="grid grid-cols-3 gap-2 mb-6">
                        ${data.stats.map(stat => `
                            <div class="glass-effect rounded-2xl p-3 text-center">
                                <p class="text-2xl font-bold text-${stat.color}-500">${stat.count}</p>
                                <p class="text-xs text-gray-600 dark:text-gray-400">${stat.label}</p>
                            </div>
                        `).join('')}
                    </div>

                    ${data.urgent.length > 0 ? `
                        <div class="glass-effect rounded-3xl p-5 mb-4 border-l-4 border-red-500">
                            <h3 class="font-semibold mb-3 flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                Срочные задания
                            </h3>
                            <div class="space-y-3">
                                ${data.urgent.map(task => `
                                    <div class="flex items-center justify-between p-3 rounded-xl bg-red-50 dark:bg-red-900/20">
                                        <div class="flex items-center">
                                            <div class="bg-red-100 dark:bg-red-800 p-2 rounded-full mr-3">
                                                <i class="${task.icon} text-red-500 dark:text-red-300"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium">${task.title}</p>
                                                <p class="text-sm text-red-600 dark:text-red-400">Дедлайн: ${task.deadline}</p>
                                            </div>
                                        </div>
                                        <button class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg text-sm transition-colors">
                                            Сдать
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <div class="glass-effect rounded-3xl p-5 mb-4">
                        <h3 class="font-semibold mb-3">Активные задания</h3>
                        <div class="space-y-3">
                            ${data.active.map(task => `
                                <div class="task-card flex items-center justify-between p-3 rounded-xl bg-${task.color}-50 dark:bg-${task.color}-900/20" data-task="${task.id}">
                                    <div class="flex items-center">
                                        <div class="bg-${task.color}-100 dark:bg-${task.color}-800 p-2 rounded-full mr-3">
                                            <i class="${task.icon} text-${task.color}-500 dark:text-${task.color}-300"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">${task.title}</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Дедлайн: ${task.deadline}</p>
                                        </div>
                                    </div>
                                    <button class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-sm transition-colors">
                                        Выполнить
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="glass-effect rounded-3xl p-5">
                        <h3 class="font-semibold mb-3">Завершенные задания</h3>
                        <div class="space-y-3">
                            ${data.completed.map(task => `
                                <div class="flex items-center justify-between p-3 rounded-xl bg-green-50 dark:bg-green-900/20">
                                    <div class="flex items-center">
                                        <div class="bg-green-100 dark:bg-green-800 p-2 rounded-full mr-3">
                                            <i class="${task.icon} text-green-500 dark:text-green-300"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">${task.title}</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">${task.details}</p>
                                        </div>
                                    </div>
                                    <button class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm transition-colors">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Функция рендеринга страницы расписания
        function renderSchedulePage() {
            const data = appData.schedule;
            
            return `
                <div id="schedule-page" class="page hidden">
                    <div class="glass-effect rounded-3xl p-6 mb-4 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-calendar mr-2 text-purple-500"></i>
                            ${data.title}
                        </h2>
                        <p class="text-gray-600 dark:text-gray-300">${data.subtitle}</p>
                        <div class="mt-2 flex items-center justify-between">
                            <span class="text-sm text-gray-600 dark:text-gray-400">${data.currentWeek}</span>
                            <div class="flex space-x-2 schedule-nav">
                                <button class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-1 px-3 rounded-lg text-sm transition-colors">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-1 px-3 rounded-lg text-sm transition-colors">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect rounded-3xl p-4 mb-4">
                        <div class="flex justify-between">
                            ${data.days.map(day => `
                                <button class="day-btn flex flex-col items-center p-2 rounded-xl ${day.active ? 'bg-blue-500 text-white' : 'text-gray-600 dark:text-gray-400'}" data-day="${day.id}">
                                    <span class="text-sm font-medium">${day.label}</span>
                                    <span class="text-lg font-bold">${day.date}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="space-y-4">
                        ${data.days.find(day => day.active)?.lessons.map(lesson => `
                            <div class="lesson-card glass-effect rounded-2xl p-5 transition-transform hover:scale-[1.02] active:scale-100">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <span class="bg-${lesson.color}-100 dark:bg-${lesson.color}-900 text-${lesson.color}-800 dark:text-${lesson.color}-200 text-xs px-2 py-1 rounded-full">
                                            ${lesson.type}
                                        </span>
                                        <h3 class="font-semibold mt-2">${lesson.subject}</h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">${lesson.instructor}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">${lesson.time}</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Ауд. ${lesson.room}</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-lg text-sm transition-colors">
                                        <i class="fas fa-video mr-1"></i> Присоединиться
                                    </button>
                                    <button class="flex-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm transition-colors">
                                        <i class="fas fa-info-circle mr-1"></i> Подробнее
                                    </button>
                                </div>
                            </div>
                        `).join('') || '<p class="text-center text-gray-600 dark:text-gray-400 py-8">На выбранный день занятий нет</p>'}
                    </div>
                </div>
            `;
        }

        // Функция рендеринга страницы успеваемости
        function renderProgressPage() {
            const data = appData.progress;
            
            return `
                <div id="progress-page" class="page hidden">
                    <div class="glass-effect rounded-3xl p-6 mb-4 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-line mr-2 text-yellow-500"></i>
                            ${data.title}
                        </h2>
                        <p class="text-gray-600 dark:text-gray-300">${data.subtitle}</p>
                    </div>

                    <div class="glass-effect rounded-3xl p-6 mb-4 text-center">
                        <div class="relative inline-block">
                            <svg class="w-32 h-32 transform -rotate-90">
                                <circle cx="64" cy="64" r="56" stroke="currentColor" stroke-width="8" fill="none" 
                                        class="text-gray-200 dark:text-gray-700"/>
                                <circle cx="64" cy="64" r="56" stroke="currentColor" stroke-width="8" fill="none" 
                                        stroke-dasharray="352" stroke-dashoffset="${352 - (352 * data.overallProgress / 100)}"
                                        class="text-green-500" stroke-linecap="round"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-2xl font-bold">${data.overallProgress}%</span>
                            </div>
                        </div>
                        <p class="mt-4 font-medium">Общий прогресс обучения</p>
                    </div>

                    <div class="space-y-4">
                        ${data.subjects.map(subject => `
                            <div class="subject-card glass-effect rounded-2xl p-5">
                                <div class="flex justify-between items-center mb-3">
                                    <div>
                                        <h3 class="font-semibold">${subject.name}</h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">${subject.instructor}</p>
                                    </div>
                                    <span class="bg-${subject.color}-100 dark:bg-${subject.color}-900 text-${subject.color}-800 dark:text-${subject.color}-200 text-sm px-3 py-1 rounded-full">
                                        ${subject.progress}%
                                    </span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                    <div class="bg-${subject.color}-500 h-2 rounded-full" style="width: ${subject.progress}%"></div>
                                </div>
                                <div class="flex justify-between text-xs text-gray-600 dark:text-gray-400 mt-1">
                                    <span>Прогресс</span>
                                    <span>${subject.progress}% завершено</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="glass-effect rounded-3xl p-6 mt-6">
                        <h3 class="font-semibold mb-4">Статистика за месяц</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-4 rounded-xl bg-blue-50 dark:bg-blue-900/20">
                                <p class="text-2xl font-bold text-blue-500">24</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Просмотрено лекций</p>
                            </div>
                            <div class="text-center p-4 rounded-xl bg-green-50 dark:bg-green-900/20">
                                <p class="text-2xl font-bold text-green-500">18</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Выполнено заданий</p>
                            </div>
                            <div class="text-center p-4 rounded-xl bg-yellow-50 dark:bg-yellow-900/20">
                                <p class="text-2xl font-bold text-yellow-500">92%</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Средняя оценка</p>
                            </div>
                            <div class="text-center p-4 rounded-xl bg-purple-50 dark:bg-purple-900/20">
                                <p class="text-2xl font-bold text-purple-500">36</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Часов обучения</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Функция рендеринга страницы настроек
        function renderSettingsPage() {
            const data = appData.settings;
            
            return `
                <div id="settings-page" class="page hidden">
                    <div class="glass-effect rounded-3xl p-6 mb-4 mt-4">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-cog mr-2 text-gray-500"></i>
                            ${data.title}
                        </h2>
                        <p class="text-gray-600 dark:text-gray-300">${data.subtitle}</p>
                    </div>

                    ${data.sections.map(section => `
                        <div class="glass-effect rounded-3xl p-5 mb-4">
                            <h3 class="font-semibold mb-4">${section.title}</h3>
                            <div class="space-y-4">
                                ${section.items.map(item => `
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">${item.title}</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">${item.subtitle}</p>
                                        </div>
                                        ${item.type === 'toggle' ? `
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" ${item.value ? 'checked' : ''} 
                                                       class="sr-only peer" id="${item.id}-toggle">
                                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-500"></div>
                                            </label>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}

                    <div class="glass-effect rounded-3xl p-5 mb-4">
                        <h3 class="font-semibold mb-4">Внешний вид</h3>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium">Темная тема</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Включить темный режим</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="dark-mode-toggle" 
                                       class="sr-only peer" ${localStorage.theme === 'dark' ? 'checked' : ''}>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-500"></div>
                            </label>
                        </div>
                    </div>

                    <div class="glass-effect rounded-3xl p-5">
                        <h3 class="font-semibold mb-4">О приложении</h3>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Версия</span>
                                <span>${appData.meta.version}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Последнее обновление</span>
                                <span>${new Date(appData.meta.lastUpdated).toLocaleDateString('ru-RU')}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Создано</span>
                                <span>${new Date(appData.meta.created).toLocaleDateString('ru-RU')}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Функция рендеринга всех страниц
        function renderAllPages() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = 
                renderHomePage() + 
                renderStudyPage() + 
                renderLecturesPage() + 
                renderTasksPage() + 
                renderSchedulePage() +
                renderProgressPage() +
                renderSettingsPage();
        }

        // ========== ФУНКЦИОНАЛЬНОСТЬ ==========

        // Навигация между страницами
        function setupNavigation() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const pages = document.querySelectorAll('.page');
            const pageTitle = document.getElementById('page-title');
            
            const pageTitles = {
                'home-page': 'Космический Университет',
                'study-page': 'Учеба',
                'lectures-page': 'Лекции', 
                'tasks-page': 'Задания',
                'schedule-page': 'Расписание',
                'progress-page': 'Успеваемость',
                'settings-page': 'Настройки'
            };
            
            // Функция для переключения страниц
            const switchPage = (targetPage) => {
                // Обновляем активную кнопку
                tabButtons.forEach(btn => {
                    btn.classList.remove('text-blue-500');
                    btn.classList.add('text-gray-500');
                });
                
                // Находим и активируем нужную кнопку
                const activeButton = Array.from(tabButtons).find(btn => btn.getAttribute('data-page') === targetPage);
                if (activeButton) {
                    activeButton.classList.remove('text-gray-500');
                    activeButton.classList.add('text-blue-500');
                }
                
                // Обновляем заголовок
                pageTitle.textContent = pageTitles[targetPage] || 'Космический Университет';
                
                // Показываем целевую страницу, скрываем остальные
                pages.forEach(page => {
                    if (page.id === targetPage) {
                        page.classList.remove('hidden');
                        // Плавная прокрутка к началу страницы
                        setTimeout(() => {
                            page.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                    } else {
                        page.classList.add('hidden');
                    }
                });
            };
            
            // Обработчики для кнопок навигации
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetPage = this.getAttribute('data-page');
                    switchPage(targetPage);
                });
            });
            
            // Обработчики для виджетов на главной странице
            document.addEventListener('click', function(e) {
                if (e.target.closest('.widget-btn')) {
                    const widget = e.target.closest('.widget-btn');
                    const targetPage = widget.getAttribute('data-action');
                    
                    if (targetPage && document.getElementById(targetPage)) {
                        switchPage(targetPage);
                        showNotification(`Открыт раздел: ${targetPage.replace('-page', '')}`);
                    } else {
                        showNotification(`Раздел "${targetPage}" временно недоступен`);
                    }
                }
            });

            // Активируем главную страницу по умолчанию
            const defaultTab = navigationData.tabs.find(tab => tab.default);
            if (defaultTab) {
                switchPage(defaultTab.id);
            }
        }

        // Настройка взаимодействий на страницах
        function setupPageInteractions() {
            // Удаление уведомлений
            document.querySelectorAll('.notification-item').forEach(item => {
                const closeBtn = item.querySelector('button');
                closeBtn.addEventListener('click', function() {
                    item.style.opacity = '0';
                    item.style.height = '0';
                    item.style.margin = '0';
                    setTimeout(() => {
                        item.remove();
                        updateNotificationBadge();
                    }, 300);
                });
            });

            // Фильтры лекций
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');
                    
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('bg-blue-500', 'text-white');
                        btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    this.classList.add('bg-blue-500', 'text-white');
                    
                    showNotification(`Применен фильтр: ${filter}`);
                });
            });

            // Переключение дней в расписании
            document.addEventListener('click', function(e) {
                if (e.target.closest('.day-btn')) {
                    const button = e.target.closest('.day-btn');
                    const dayId = button.getAttribute('data-day');
                    
                    document.querySelectorAll('.day-btn').forEach(btn => {
                        btn.classList.remove('bg-blue-500', 'text-white');
                        btn.classList.add('text-gray-600', 'dark:text-gray-400');
                    });
                    button.classList.remove('text-gray-600', 'dark:text-gray-400');
                    button.classList.add('bg-blue-500', 'text-white');
                    
                    showNotification(`Показано расписание на ${button.querySelector('span:last-child').textContent} число`);
                }
            });

            // Навигация по неделям в расписании
            document.querySelectorAll('.schedule-nav button').forEach(button => {
                button.addEventListener('click', function() {
                    const direction = this.querySelector('i').classList.contains('fa-chevron-left') ? 'предыдущую' : 'следующую';
                    showNotification(`Загружена ${direction} неделя`);
                });
            });

            // Кнопка управления Gist
            document.addEventListener('click', function(e) {
                if (e.target.closest('#manage-gist')) {
                    showGistModal();
                }
            });

            // Кнопки в модальном окне Gist
            document.getElementById('load-gist').addEventListener('click', loadFromGist);
            document.getElementById('save-gist').addEventListener('click', saveToGist);
            document.getElementById('close-gist-modal').addEventListener('click', hideGistModal);

            // Закрытие модального окна по клику вне его
            document.getElementById('gist-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideGistModal();
                }
            });

            // Кнопки заданий
            document.querySelectorAll('.task-card button').forEach(button => {
                if (button.textContent.includes('Сдать') || button.textContent.includes('Выполнить')) {
                    button.addEventListener('click', function() {
                        const taskCard = this.closest('.task-card');
                        const taskTitle = taskCard.querySelector('.font-medium').textContent;
                        showNotification(`Задание "${taskTitle}" открыто для выполнения`);
                    });
                }
            });

            // Кнопки лекций
            document.querySelectorAll('.lecture-card button').forEach(button => {
                if (button.textContent.includes('Смотреть') || button.textContent.includes('Продолжить') || button.textContent.includes('Пересмотреть')) {
                    button.addEventListener('click', function() {
                        const lectureCard = this.closest('.lecture-card');
                        const lectureTitle = lectureCard.querySelector('h3').textContent;
                        showNotification(`Лекция "${lectureTitle}" запущена`);
                    });
                }
            });

            // Кнопки курсов
            document.querySelectorAll('.course-card button').forEach(button => {
                if (button.textContent.includes('Продолжить') || button.textContent.includes('Начать') || button.textContent.includes('Подробнее')) {
                    button.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const courseCard = this.closest('.course-card');
                        const courseTitle = courseCard.querySelector('h3').textContent;
                        const action = button.textContent.includes('Подробнее') ? 'Информация о курсе' : 'Курс открыт для изучения';
                        showNotification(`${action}: "${courseTitle}"`);
                    });
                }
            });

            // Кнопка уведомлений в хедере
            document.getElementById('notifications-btn').addEventListener('click', function() {
                showNotification('Показаны все уведомления');
            });

            // Переключатели в настройках
            document.addEventListener('change', function(e) {
                if (e.target.id === 'dark-mode-toggle') {
                    toggleTheme();
                } else if (e.target.type === 'checkbox') {
                    const settingName = e.target.id.replace('-toggle', '');
                    showNotification(`Настройка "${settingName}" ${e.target.checked ? 'включена' : 'выключена'}`);
                }
            });
        }

        // Функциональность переключения темы
        function setupThemeToggle() {
            const themeToggleBtn = document.getElementById('theme-toggle');
            
            // Проверяем сохраненную тему
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                themeToggleBtn.innerHTML = '<i class="fas fa-sun text-yellow-300"></i>';
            } else {
                document.documentElement.classList.remove('dark');
                themeToggleBtn.innerHTML = '<i class="fas fa-moon text-gray-700"></i>';
            }
            
            themeToggleBtn.addEventListener('click', function() {
                toggleTheme();
            });
        }
        
        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-moon text-gray-700"></i>';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun text-yellow-300"></i>';
            }
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notification-count');
            const currentCount = parseInt(badge.textContent);
            if (currentCount > 0) {
                badge.textContent = currentCount - 1;
                if (currentCount - 1 === 0) {
                    badge.style.display = 'none';
                }
            }
        }

        function showNotification(message) {
            // Удаляем существующие уведомления
            const existingNotifications = document.querySelectorAll('.custom-notification');
            existingNotifications.forEach(notification => notification.remove());

            const notification = document.createElement('div');
            notification.className = 'custom-notification fixed top-20 left-1/2 transform -translate-x-1/2 glass-effect rounded-xl p-4 z-50 transition-all duration-300 opacity-0 translate-y-2';
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                    <span class="text-sm">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('opacity-0', 'translate-y-2');
                notification.classList.add('opacity-100', 'translate-y-0');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('opacity-100', 'translate-y-0');
                notification.classList.add('opacity-0', 'translate-y-2');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            renderNavigation();
            renderAllPages();
            setupThemeToggle();
            setupNavigation();
            setupPageInteractions();
            
            // Показываем информацию о Gist, если есть сохраненные настройки
            if (GIST_CONFIG.GIST_ID) {
                console.log('Gist настроен:', GIST_CONFIG.GIST_ID);
            }
        });
    </script>
</body>
</html>